angular.module("fpiwebapp",["ngRoute","ngSanitize","fpiwebapp.region.service","fpiwebapp.region.ctrl","fpiwebapp.search.ctrl","fpiwebapp.search.service","fpiwebapp.choose.ctrl","fpiwebapp.category.ctrl","fpiwebapp.home.ctrl","fpiwebapp.homeCate.ctrl","fpiwebapp.exceed.ctrl","fpiwebapp.transport.ctrl","fpiwebapp.personal.ctrl","fpiwebapp.account.ctrl","fpiwebapp.companyDetail.ctrl","fpiwebapp.companyDetailTab.ctrl","fpiwebapp.common","fpiwebapp.home.service","fpiwebapp.directives","fpiwebapp.service","fpiwebapp.calendar","angular-md5","LocalStorageModule"]).config(function($routeProvider){$routeProvider.when("/",{controller:"HomeController",templateUrl:"/app/partials/home/home.html"}).when("/cate/:cateCode",{controller:"HomeCateController",templateUrl:"/app/partials/home/home.html"}).when("/account",{controller:"AccountController",templateUrl:"/app/partials/personal/account.html"}).when("/selectRegion",{controller:"SelectRegionController",templateUrl:"/app/partials/region/region.html"}).when("/choose/:id/:currentCate",{controller:"ChooseController",templateUrl:"/app/partials/choose/choose.html"}).when("/search",{controller:"SearchController",templateUrl:"/app/partials/search/search.html"}).when("/search/:key",{controller:"SearchController",templateUrl:"/app/partials/search/search.html"}).when("/exceed",{controller:"ExceedController",templateUrl:"/app/partials/exceed/exceed.html"}).when("/transport",{controller:"TransportController",templateUrl:"/app/partials/transport/transport.html"}).when("/personal",{controller:"PersonalController",templateUrl:"/app/partials/personal/personal.html"}).when("/companyDetail/:id/:currentCate",{controller:"CompanyDetailController",templateUrl:"/app/partials/company/companyDetail.html"}).otherwise({redirectTo:"/"})}).run(function($http,$rootScope,$window,$location,MenuServer,localStorageService){$rootScope.back=function(){$window.history.back()},$rootScope.categoryItem="WW",$rootScope.choiceMenu=function(){$rootScope.menu.showItems()},$rootScope.contentHeight=$(window).innerHeight(),$rootScope.checkUser=function(){return $rootScope.user=localStorageService.get("currentUser"),$rootScope.user?$rootScope.user:void($window.location.href="/")},$rootScope.currentDate=function(addDayCount){var dateString="",curDate=new Date;return curDate.setDate(curDate.getDate()+addDayCount),dateString=curDate.getFullYear()+"-"+(curDate.getMonth()+1)+"-"+curDate.getDate()},$rootScope.formatTime=function(curDate){var dateString="";return dateString=curDate.substring(1,11)}}),angular.module("fpiwebapp.region.service",["ngResource"]).factory("RegionService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"/mobile/mobile/load/getRegion.do?monitorTypeCode=WW&userName=root",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"}})}]),angular.module("fpiwebapp.region.ctrl",["LocalStorageModule"]).controller("SelectRegionController",function($scope,$location,$rootScope,localStorageService,RegionService){$scope.currentName=localStorageService.get("currentRegions"),$scope.currentCate=localStorageService.get("currentCategory"),$scope.isLoading=!1,$scope.regions=[],RegionService.query(function(result){var regionData=result.region;if(regionData.length>0){for(var i=0;i<regionData.length;i++){var item=regionData[i];$scope.regions.push({name:item.regionName,code:item.regionCode})}$scope.isLoading=!0,$scope.dataFunc($scope.regions)}}),$scope.dataFunc=function(regions){for(var areas=[],i=0;i<regions.length;i++)i%3==0&&areas.push([]),areas[areas.length-1].push(regions[i]);return $scope.areas=areas},$scope.dataFunc($scope.regions),$scope.selectFunc=function(name,code){console.log(name),localStorageService.set("currentRegions",name),localStorageService.set("currentRegionCode",code),$location.path("/cate/"+$scope.currentCate)}}),angular.module("fpiwebapp.search.ctrl",["LocalStorageModule","fpiwebapp.search.service"]).filter("keyWords",function(){return keyWordsFilter}).controller("SearchController",function($rootScope,$scope,$location,$routeParams,localStorageService,SearchService,$sce){$scope.currentUser=$rootScope.checkUser(),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.toggle=!1,$scope.htmlShow=function(str){var key=$scope.name,words=str,color="#19b2e4",sKey="<span style='color: "+color+";'>"+key+"</span>",rStr=new RegExp(key,"g");return words=words.replace(rStr,sKey),$sce.trustAsHtml(words)},$scope.focusFunc=function(){console.log("focus"),$scope.toggle=!0},$scope.isNoData=!1,$scope.hasData=!1,$scope.name=$routeParams.key||"",$scope.companyArray=[],void 0!==$scope.name&&SearchService.search({monitorTypeCode:$scope.currentCategory,companyName:$scope.name,userName:$scope.currentUser},function(result){result&&($scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0))}),$scope.search=function(){$location.path("/search/"+$scope.key)},$scope.quickFunc=function(manageLevel){switch($scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!1,manageLevel){case 1:$scope.isActiveA=!0,$scope.isActiveB=!1,$scope.isActiveC=!1;break;case 2:$scope.isActiveA=!1,$scope.isActiveB=!0,$scope.isActiveC=!1;break;case 3:$scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!0}SearchService.quickSearch({monitorTypeCode:$scope.currentCategory,manageLevel:manageLevel,userName:$scope.currentUser},function(result){result&&($scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0))})},$scope.clearHistory=function(){$scope.companyArray=[]}}).filter("keyWords",function(){var keyWordsFilter=function(input){var text="",keyWords="长兴",words=input;return text=words.replace(keyWords,'<span style="color: red;">'+keyWords+"</span>")};return keyWordsFilter}),angular.module("fpiwebapp.search.service",["ngResource"]).factory("SearchService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},search:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getCompany.do"},quickSearch:{method:"JSONP",url:platformServer+"/mobile/mobile/load/QuickSearchCompany.do"}})}]),angular.module("fpiwebapp.choose.ctrl",["LocalStorageModule"]).controller("ChooseController",function($window,$rootScope,$scope,$location,$routeParams,localStorageService){$scope.currentCate=$routeParams.currentCate,$scope.companyId=$routeParams.id,$scope.currentTime=localStorageService.get("currentDateTime"),$scope.setCurrentDate=function(date){var time=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();$scope.currentTime=time,localStorageService.set("currentDateTime",$scope.currentTime)},$scope.defineFunc=function(){$window.location.href="#/companyDetail/"+$scope.companyId+"/"+$scope.currentCate},$scope.factorData=localStorageService.get("currentFactor"),$scope.archive=function(){var oldFactor=$scope.factorData;oldFactor.splice(this.$index,1,{text:this.factor.text,done:!this.factor.done}),localStorageService.set("currentFactor",oldFactor),$rootScope.isFactorSave=!1},$scope.remaining=function(){var count=0;return angular.forEach($scope.factorData,function(todo){count+=todo.done?1:0}),count}}),angular.module("fpiwebapp.category.ctrl",["LocalStorageModule"]).controller("CategoryController",function($scope,$rootScope,$location){$rootScope.checkUser(),$(".category").css("height",$rootScope.contentHeight+"px"),$scope.list=[],$scope.user="",$scope.passw="",$scope.submit=function(){$location.path("/main")}}),angular.module("fpiwebapp.home.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeController",function($scope,$rootScope,$routeParams,$location,$window,localStorageService,MenuServer,RegionService,HomeService){function drawProcess(){$("canvas.process").each(function(){var canpi=40,text=$(this).text(),process=text.substring(0,text.length-1),canvas=this,context=canvas.getContext("2d");context.clearRect(0,0,canpi,canpi),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI,!1),context.closePath(),context.fillStyle="#f5f5f5",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI*process/100,!1),context.closePath(),context.fillStyle="#ffa54b",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi-7,0,2*Math.PI,!0),context.closePath(),context.fillStyle="rgba(255,255,255,1)",context.fill(),context.font="bold 20px Arial",context.fillStyle="#ffa54b",context.textAlign="center",context.textBaseline="middle",context.moveTo(canpi,canpi),context.fillText(text,canpi,canpi)})}$scope.switchingCate=function(){console.log("fpi")},$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegion=localStorageService.get("currentRegions"),$scope.currentUser=localStorageService.get("currentUser"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),$scope.transPercentData=[],$scope.transPercentDataTxt=["传输率","有效率","传输有效率"],HomeService.getEfficiency({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,dateTime:"2014-9-3",userName:$scope.currentUser},function(result){if(result){var trans=result.transEfficients;$scope.transPercentData.push(trans[0].transPercent),$scope.transPercentData.push(trans[0].efficientPercent),$scope.transPercentData.push(trans[0].transEfficientPercent)}}),$scope.$on("ngRepeatFinished",function(){drawProcess()}),$scope.stateData=[],HomeService.getState({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,userName:$scope.currentUser},function(result){result&&($scope.stateData=result.region)}),HomeService.getOverStandardData({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,time:"2014-8-3",userName:$scope.currentUser},function(result){}),$scope.imgWidth=$(document).width(),RegionService.query(function(result){var data=result.region;data&&($scope.regionName=localStorageService.get("currentRegion")||data[0].regionName)}),$scope.showCompanyDetail=function(){$location.path("/companyDetail/:id")}}).directive("onFinishRenderFilters",function($timeout){return{restrict:"A",link:function(scope){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.homeCate.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeCateController",function($route,$scope,$rootScope,$routeParams,$location,$window,localStorageService,MenuServer,RegionService,HomeService){function drawProcess(){var colors=["#ffa54b","#f57d6e","#53e18c"];$("canvas.process").each(function(index){var canpi=40,text=$(this).text(),process=text.substring(0,text.length-1),canvas=this,context=canvas.getContext("2d");context.clearRect(0,0,canpi,canpi),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI,!1),context.closePath(),context.fillStyle="#f5f5f5",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI*process/100,!1),context.closePath(),context.fillStyle=colors[index],context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi-7,0,2*Math.PI,!0),context.closePath(),context.fillStyle="rgba(255,255,255,1)",context.fill(),context.font="normal 18px arial",context.fillStyle=colors[index],context.textAlign="center",context.textBaseline="middle",context.moveTo(canpi,canpi),context.fillText(text,canpi,canpi)})}$scope.nowDate=$rootScope.currentDate(0),$scope.preDate=$rootScope.currentDate(-1),$scope.currentUser=$rootScope.checkUser(),$scope.routeCategory=$routeParams.cateCode,localStorageService.set("currentCategory",$scope.routeCategory),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegion=localStorageService.get("currentRegions"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),"WW"==$scope.currentCategory&&($scope.isActive=!0),"WG"==$scope.currentCategory&&($scope.isSubActive=!0),$scope.refresh=function(){$route.reload()},console.log($scope.currentCategory),$scope.transPercentDataTxt=["传输率","有效率","传输有效率"],HomeService.getEfficiency({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,dateTime:$scope.preDate,userName:$scope.currentUser},function(result){if(result){$scope.transPercentData=[];var trans=result.transEfficients;$scope.transPercentData.push({code:trans[0].transPercent}),$scope.transPercentData.push({code:trans[0].efficientPercent}),$scope.transPercentData.push({code:trans[0].transEfficientPercent}),console.log($scope.transPercentData)}}),$scope.$on("ngRepeatFinished",function(){drawProcess()}),$scope.stateData=[],HomeService.getState({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,userName:$scope.currentUser},function(result){result&&($scope.stateData=result.region)}),$scope.noStandardData=!1,$scope.overStandardData=[],HomeService.getOverStandardData({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,time:$scope.nowDate,userName:$scope.currentUser},function(result){result&&(result.overStandardData.length>0?$scope.overStandardData=result.overStandardData:$scope.noStandardData=!0)}),$scope.showCompanyDetail=function(id,currentCate){$window.location.href="#/companyDetail/"+id+"/"+currentCate}}).directive("onFinishRenderFilters",function($timeout){return{restrict:"A",link:function(scope){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.home.service",["ngResource"]).factory("HomeService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},getState:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getState.do"},getEfficiency:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getTransmissionEfficientBySelfRegion.do"},getOverStandardData:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardData.do"},getOverStandardDataByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardDataByCompany.do"},getDetailOverStandardDataByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getDetailOverStandardDataByCompany.do"},getPortsByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getPortsByCompany.do"},getRealDataByTable:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getRealDataByTable.do"},get24RealDataByChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/get24RealDataByChart.do"},get48RealDataByChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/get48RealDataByChart.do"},getHistoryData:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getHistoryData.do"},getHistoryChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getHistoryChart.do"}})}]),angular.module("fpiwebapp.exceed.ctrl",["LocalStorageModule"]).controller("ExceedController",function(){}),angular.module("fpiwebapp.transport.ctrl",["LocalStorageModule"]).controller("TransportController",function(){}),angular.module("fpiwebapp.personal.ctrl",["LocalStorageModule"]).controller("PersonalController",function(){}),angular.module("fpiwebapp.account.ctrl",["LocalStorageModule"]).controller("AccountController",function($route,$scope,$rootScope,$location,$window,localStorageService){$scope.currentUser=$rootScope.checkUser(),$scope.signOut=function(){localStorageService.clearAll(),$route.reload()}}),angular.module("fpiwebapp.companyDetail.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("CompanyDetailController",function($scope,$rootScope,$location,$window,$routeParams,localStorageService,MenuServer,HomeService){$scope.companyId=$routeParams.id,$scope.currentItem=$routeParams.currentCate,$scope.nowDate=$rootScope.currentDate(0),localStorageService.get("currentDateTime")||localStorageService.set("currentDateTime",$scope.nowDate),$scope.currentTime=localStorageService.get("currentDateTime"),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.isActive=!1,$scope.toggleCate=function(){$scope.isActive=!0},$scope.portNameArray=[],$scope.portsDataByCompany=function(){HomeService.getPortsByCompany({monitorTypeCode:$scope.currentCategory,companyId:$scope.companyId},function(result){result&&($scope.portNameArray=result.ports,localStorageService.set("currentPorts",{portName:result.ports[0].portName,portId:result.ports[0].portId}),$scope.currentPorts=localStorageService.get("currentPorts").portName,$scope.realDataByTable(result.ports[0].portId,result.ports[0].portName),$scope.getHistoryDataFunc(result.ports[0].portId,$scope.nowDate),$scope.getOverStandarData(result.ports[0].portId,$scope.nowDate))})},$scope.realDataByTableArray=[],$scope.realLoading=$scope.realDataByTableArray.length>0?!1:!0,$scope.realDataByTable=function(portId,portName){localStorageService.set("currentPorts",{portName:portName,portId:portId}),$scope.currentPorts=localStorageService.get("currentPorts").portName,$scope.isActive=!1,HomeService.getRealDataByTable({monitorTypeCode:$scope.currentCategory,portId:portId},function(result){result&&($scope.realDataByTableArray=result.realDataTbale,$scope.realLoading=!1)})},$scope.historyDataArray=[],$scope.historyLoading=$scope.historyDataArray.length>0?!1:!0,$scope.getHistoryDataFunc=function(portId,time){HomeService.getHistoryData({portId:portId,monitorTypeCode:$scope.currentCategory,factors:"-1",dateType:1,time:time},function(result){result&&($scope.historyDataArray=result.data,$scope.historyLoading=!1)})},$scope.overStandarData=[],$scope.getOverStandarData=function(portId,time){HomeService.getOverStandardDataByCompany({monitorTypeCode:$scope.currentCategory,portId:portId,factorIds:"-1",dateType:1,time:time},function(result){result&&($scope.overStandarData=result.overStandardData)})}}).directive("tabDetail",["$location",function(){return{restrict:"EA",replace:!0,templateUrl:"partials/company/tab-detail.html",link:function(scope){scope.isShow=!1},controller:function($scope,localStorageService){function controlTab(index){$(".tab-content").hide(),$(".tab-content").eq(index).show(),runCurrentLine(index),0==index?localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.realDataByTable($scope.currentPortsAll.portId,$scope.currentPortsAll.portName)):1==index?localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.getHistoryDataFunc($scope.currentPortsAll.portId,$scope.currentTime)):2==index&&localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.getOverStandarData($scope.currentPortsAll.portId,$scope.currentTime))}function runCurrentLine(index){line.animate({left:leftArray[index]+"px"})}$scope.portsDataByCompany();var currentItem=$scope.currentItem;$(".tab-content").hide(),$(".tab-content").eq(currentItem).show();for(var tabs=$(".tab").find("a"),line=$(".c-line"),leftArray=[],i=0;i<tabs.length;i++)leftArray.push(tabs[i].offsetLeft);line.css("left",leftArray[currentItem]+"px"),tabs.click(function(){var index=$(this).index();controlTab(index)}),controlTab($scope.currentItem)}}}]),angular.module("fpiwebapp.companyDetailTab.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("CompanyDetailTabController",function($scope,$rootScope,$location,$window,$routeParams,localStorageService,MenuServer,HomeService){$scope.showChartFunc=function($event){HomeService.get24RealDataByChart({portId:"2c93871641b6111b0141b61a1f600002",monitorTypeCode:"WW",factor:"F_B01"},function(result){}),$event.currentTarget&&(angular.element("#chartTr")&&angular.element("#chartTr").remove(),angular.element($event.currentTarget).after('<tr id="chartTr"><td colspan="4"><div id="chartcontainer" style="margin: 0 auto; width: 320px;">fpi</div></td></tr>'));var myData=new Array([10,20],[15,10],[20,30],[25,10],[30,5]),myChart=new JSChart("chartcontainer","line");myChart.setDataArray(myData),myChart.setSize(320,220),myChart.setTitle("fpi"),myChart.draw()},$scope.addRow=function(target){console.log(target.parent)},$scope.myText="Not Selected",$scope.currentDate="",$scope.updateMyText=function(){$scope.myText="Selected"};HomeService.getDetailOverStandardDataByCompany({monitorTypeCode:"WW",portId:"2c93871641b498170141b49cfb6b0004",factorId:"2c93871641b5db390141b5def6f80001",standardValue:"30.0",companyName:"长兴兴长污水处理有限公司",dateType:1,time:"2014-09-09"},function(result){}),HomeService.getHistoryChart({monitorTypeCode:"WW",portId:"2c93871641b498170141b49cfb6b0004",factors:"-1",dateType:1,time:"2014-09-09"},function(result){}),$scope.isActiveHistory=!1,$scope.showHistoryTable=function(){$scope.isActiveHistory=!1},$scope.showHistoryChart=function(){$scope.isActiveHistory=!0;var myChart=new JSChart("history-chart","line");myChart.setDataArray([[1,80],[2,40],[3,60],[4,65],[5,50],[6,50],[7,60],[8,80],[9,150],[10,100]],"blue"),myChart.setDataArray([[1,100],[2,55],[3,80],[4,115],[5,80],[6,70],[7,30],[8,130],[9,160],[10,170]],"green"),myChart.setDataArray([[1,150],[2,25],[3,100],[4,80],[5,20],[6,65],[7,0],[8,155],[9,190],[10,200]],"gray"),myChart.setAxisPaddingBottom(40),myChart.setTextPaddingBottom(10),myChart.setAxisValuesNumberY(5),myChart.setIntervalStartY(0),myChart.setIntervalEndY(200),myChart.setLabelX([2,"p1"]),myChart.setLabelX([4,"p2"]),myChart.setLabelX([6,"p3"]),myChart.setLabelX([8,"p4"]),myChart.setLabelX([10,"p5"]),myChart.setAxisValuesNumberX(5),myChart.setShowXValues(!1),myChart.setTitleColor("#454545"),myChart.setAxisValuesColor("#454545"),myChart.setLineColor("#A4D314","green"),myChart.setLineColor("#BBBBBB","gray"),myChart.setFlagColor("#9D16FC"),myChart.setFlagRadius(4),myChart.setSize(320,321),myChart.setTitle("fpi-inc"),myChart.draw()}}),angular.module("fpiwebapp.common",[]).factory("platformServer",function(){return platformServer}).factory("LoadingServer",function(){var LoadingServer=function(){};return LoadingServer.prototype={},LoadingServer}).factory("MenuServer",function($rootScope){var MenuServer=function(){this.cover=null,this.menuArray=[]};return MenuServer.prototype={init:function(){this.createMenu(),this.createBgDom(),this.hideItems()},showItems:function(){for(var self=this,i=0;i<self.menuArray.length;i++)$(self.menuArray[i]).show(),function(item){setTimeout(function(){$(self.menuArray[item]).animate({left:"20px"})},100*(item+1))}(i);$(self.cover).show()},hideItems:function(){for(var self=this,i=0;i<self.menuArray.length;i++)$(self.menuArray[i]).hide().css("left","0");$(self.cover).hide()},createBgDom:function(){var self=this;this.cover=document.createElement("div"),this.cover.setAttribute("class","coverCls"),this.cover.style.height=jQuery(document).height()+"px",$("body").append(this.cover),this.cover.addEventListener("click",function(){self.hideItems()})},removeCoverItem:function(){var self=this;self.cover.remove()},removeMenuItem:function(){for(var self=this,i=0;i<self.menuArray.length;i++)self.menuArray[i].remove();$rootScope.isChoice=!1},createMenu:function(){for(var self=this,pmenu=[],menus=[{name:"首页",href:"#/main",url:"images/home.png"},{name:"超标统计",href:"#/exceed",url:"images/m2.png"},{name:"传输有效率",href:"#/transport",url:"images/m3.png"},{name:"我的关注",href:"#/personal",url:"images/m4.png"}],i=0;i<menus.length;i++){var menuItem=document.createElement("div");menuItem.setAttribute("class","menuItemCls"),menuItem.innerHTML='<a href="'+menus[i].href+'"><img src="'+menus[i].url+'" width="32" height="32" border="0">'+menus[i].name+"</a>",menuItem.style.top=20+50*(i+1)+"px",$("body").append(menuItem),this.menuArray.push(menuItem),pmenu.push(menuItem),menuItem.addEventListener("click",function(){self.hideItems()})}}},MenuServer}),angular.module("fpiwebapp.directives",[]).directive("datepicker",function(){return{restrict:"A",require:"?ngModel",scope:{select:"&"},link:function(scope,element,attrs,ngModel){if(ngModel){var optionsObj={};optionsObj.dateFormat="mm/dd/yy";var updateModel=function(dateTxt){scope.$apply(function(){ngModel.$setViewValue(dateTxt)})};optionsObj.onSelect=function(dateTxt){updateModel(dateTxt),scope.select&&scope.$apply(function(){scope.select({date:dateTxt})})},ngModel.$render=function(){element.datepicker("setDate",ngModel.$viewValue||"")},element.datepicker(optionsObj)}}}}),angular.module("fpiwebapp.calendar",["fpiwebapp.service","LocalStorageModule"]).directive("calendar",function(dateutil,localStorageService){function CalendarModel(date){this.currentDate=date,this.weekNumber=dateutil.getWeekNumberOfMonth(date),this.firstDate=dateutil.getFirstDateOfFirstWeek(date),this.fY=this.firstDate.getFullYear(),this.fM=this.firstDate.getMonth(),this.fD=this.firstDate.getDate()}return CalendarModel.prototype={get:function(index){return new Date(this.fY,this.fM,this.fD+index)},getDate:function(index){return this.get(index).getDate()},monthText:function(){return this.currentDate.getFullYear()+"年"+(this.currentDate.getMonth()+1)+"月"},checkWeek:function(week){return this.weekNumber>=week},isCurrentMonth:function(index){var date=this.get(index);return date.getMonth()==this.currentDate.getMonth()},isCurrentDate:function(index){var date=this.get(index);return date.getFullYear()==this.currentDate.getFullYear()&&date.getMonth()==this.currentDate.getMonth()&&date.getDate()==this.currentDate.getDate()}},{restrict:"EA",replace:!0,scope:{updateDateMethod:"@"},templateUrl:"/app/partials/calendar.html",link:function(scope,element){var nowDate=localStorageService.get("currentDateTime"),now=new Date(Date.parse(nowDate.replace(/-/g,"/")));element.on("swiperight",function(){alert("fuck")}),$("table a",element).each(function(i){$(this).click(function(){var currentDate=scope.calendarModel.get(i),parentUpdateDateMethod=scope.$parent[scope.updateDateMethod];parentUpdateDateMethod&&parentUpdateDateMethod(currentDate),scope.calendarModel=new CalendarModel(currentDate),scope.$apply(scope.calendarModel)})}),scope.calendarModel=new CalendarModel(now)}}}),angular.module("fpiwebapp.service",[]).factory("dateutil",function(){return{getWeekNumberOfMonth:function(date){return this.getWeekOfMonth(this.getLastDateOfMonth(date))},getWeekOfMonth:function(date){var dayOfWeek=date.getDay(),dayOfMonth=date.getDate();return Math.ceil((dayOfMonth-(dayOfWeek+1)+7)/7)},getLastDateOfMonth:function(date){return new Date(date.getFullYear(),date.getMonth()+1,0)},getFirstDateOfFirstWeek:function(date){var d=new Date(date.getFullYear(),date.getMonth(),date.getDate());d.setDate(1);var dayOfWeek=d.getDay();return d.setDate(1-dayOfWeek),d}}});