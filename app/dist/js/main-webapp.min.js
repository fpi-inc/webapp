angular.module("fpiwebapp",["ngRoute","ngSanitize","fpiwebapp.region.service","fpiwebapp.region.ctrl","fpiwebapp.search.ctrl","fpiwebapp.search.service","fpiwebapp.choose.ctrl","fpiwebapp.category.ctrl","fpiwebapp.home.ctrl","fpiwebapp.homeCate.ctrl","fpiwebapp.stateDetail.ctrl","fpiwebapp.exceed.ctrl","fpiwebapp.transport.ctrl","fpiwebapp.personal.ctrl","fpiwebapp.personal.add.ctrl","fpiwebapp.account.ctrl","fpiwebapp.companyDetail.ctrl","fpiwebapp.companyDetailTab.ctrl","fpiwebapp.common","fpiwebapp.home.service","fpiwebapp.personal.service","fpiwebapp.directives","fpiwebapp.service","fpiwebapp.calendar","angular-md5","LocalStorageModule"]).config(function($routeProvider){$routeProvider.when("/",{controller:"HomeController",templateUrl:"/app/partials/home/home.html"}).when("/cate/:cateCode",{controller:"HomeCateController",templateUrl:"/app/partials/home/home.html"}).when("/stateDetail/:state",{controller:"StateDetailController",templateUrl:"/app/partials/state/stateDetail.html"}).when("/account",{controller:"AccountController",templateUrl:"/app/partials/personal/account.html"}).when("/selectRegion",{controller:"SelectRegionController",templateUrl:"/app/partials/region/region.html"}).when("/choose/:id/:currentCate/:date",{controller:"ChooseController",templateUrl:"/app/partials/choose/choose.html"}).when("/search",{controller:"SearchController",templateUrl:"/app/partials/search/search.html"}).when("/search/:key",{controller:"SearchController",templateUrl:"/app/partials/search/search.html"}).when("/exceed",{controller:"ExceedController",templateUrl:"/app/partials/exceed/exceed.html"}).when("/transport",{controller:"TransportController",templateUrl:"/app/partials/transport/transport.html"}).when("/personal",{controller:"PersonalController",templateUrl:"/app/partials/personal/personal.html"}).when("/attentionCompany",{controller:"AddCompanyController",templateUrl:"/app/partials/personal/personalCompany.html"}).when("/searchAttention/:key",{controller:"SearchController",templateUrl:"/app/partials/personal/personalCompany.html"}).when("/companyDetail/:id/:currentCate",{controller:"CompanyDetailController",templateUrl:"/app/partials/company/companyDetail.html"}).otherwise({redirectTo:"/"})}).run(function($http,$rootScope,$window,$location,MenuServer,localStorageService){$rootScope.back=function(){$window.history.back()},$rootScope.categoryItem="WW",$rootScope.choiceMenu=function(){$rootScope.menu.showItems()},$rootScope.contentHeight=$(window).innerHeight(),$rootScope.checkUser=function(){return $rootScope.user=localStorageService.get("currentUser"),$rootScope.user?$rootScope.user:void($window.location.href="/")},$rootScope.currentDate=function(addDayCount){var dateString="",curDate=new Date;return curDate.setDate(curDate.getDate()+addDayCount),dateString=curDate.getFullYear()+"-"+(curDate.getMonth()+1)+"-"+curDate.getDate()},$rootScope.formatTime=function(curDate){var dateString="";return dateString=curDate.substring(1,11)}}),angular.module("fpiwebapp.region.service",["ngResource"]).factory("RegionService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"/mobile/mobile/load/getRegion.do?monitorTypeCode=WW&userName=root",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"}})}]),angular.module("fpiwebapp.region.ctrl",["LocalStorageModule"]).controller("SelectRegionController",function($scope,$location,$rootScope,localStorageService,RegionService){$scope.currentName=localStorageService.get("currentRegions"),$scope.currentCate=localStorageService.get("currentCategory"),$scope.isLoading=!1,$scope.regions=[],RegionService.query(function(result){var regionData=result.region;if(regionData.length>0){for(var i=0;i<regionData.length;i++){var item=regionData[i];$scope.regions.push({name:item.regionName,code:item.regionCode})}$scope.isLoading=!0,$scope.dataFunc($scope.regions)}}),$scope.dataFunc=function(regions){for(var areas=[],i=0;i<regions.length;i++)i%3==0&&areas.push([]),areas[areas.length-1].push(regions[i]);return $scope.areas=areas},$scope.dataFunc($scope.regions),$scope.selectFunc=function(name,code){console.log(name),localStorageService.set("currentRegions",name),localStorageService.set("currentRegionCode",code),$location.path("/cate/"+$scope.currentCate)}}),angular.module("fpiwebapp.search.ctrl",["LocalStorageModule","fpiwebapp.personal.service","fpiwebapp.search.service"]).filter("keyWords",function(){return keyWordsFilter}).controller("SearchController",function($rootScope,$scope,$location,$routeParams,localStorageService,PersonalService,SearchService,$sce){$scope.currentUser=$rootScope.checkUser(),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.toggle=!1,$scope.htmlShow=function(str){var key=$scope.name,words=str,color="#19b2e4",sKey="<span style='color: "+color+";'>"+key+"</span>",rStr=new RegExp(key,"g");return words=words.replace(rStr,sKey),$sce.trustAsHtml(words)},$scope.focusFunc=function(){console.log("focus"),$scope.toggle=!0},$scope.isNoData=!1,$scope.hasData=!1,$scope.name=$routeParams.key||"",$scope.companyArray=[],void 0!==$scope.name&&SearchService.search({monitorTypeCode:$scope.currentCategory,companyName:$scope.name,userName:$scope.currentUser},function(result){result&&($scope.companyAttentionArray=[],$scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0),angular.forEach($scope.companyArray,function(value){PersonalService.hasAttention({userName:$scope.currentUser,companyId:value.companyId},function(result){if(result){var txt={};"true"==result.result?(txt.html="已关注",txt.css="atten"):(txt.html="未关注",txt.css="addAtten"),$scope.companyAttentionArray.push(txt)}})}))}),$scope.addAttentionFunc=function(compId,txt){"已关注"!=txt&&PersonalService.saveAttention({userName:$scope.currentUser,companyId:compId},function(result){result&&$location.path("/personal")})},$scope.search=function(){$location.path("/searchAttention/"+$scope.key)},$scope.quickFunc=function(manageLevel){switch($scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!1,manageLevel){case 1:$scope.isActiveA=!0,$scope.isActiveB=!1,$scope.isActiveC=!1;break;case 2:$scope.isActiveA=!1,$scope.isActiveB=!0,$scope.isActiveC=!1;break;case 3:$scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!0}SearchService.quickSearch({monitorTypeCode:$scope.currentCategory,manageLevel:manageLevel,userName:$scope.currentUser},function(result){result&&($scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0))})},$scope.clearHistory=function(){$scope.companyArray=[]},$scope.clearPortsCache=function(){localStorageService.remove("currentPorts")}}).filter("keyWords",function(){var keyWordsFilter=function(input){var text="",keyWords="长兴",words=input;return text=words.replace(keyWords,'<span style="color: red;">'+keyWords+"</span>")};return keyWordsFilter}),angular.module("fpiwebapp.search.service",["ngResource"]).factory("SearchService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},search:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getCompany.do"},quickSearch:{method:"JSONP",url:platformServer+"/mobile/mobile/load/QuickSearchCompany.do"}})}]),angular.module("fpiwebapp.choose.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("ChooseController",function($window,$rootScope,$scope,$location,$routeParams,localStorageService){$scope.currentCategory=localStorageService.get("currentCategory"),$scope.factorDataCache=localStorageService.get("currentFactor"),$scope.noyzData=$scope.factorDataCache.length?!0:!1,$scope.currentCate=$routeParams.currentCate,$scope.companyId=$routeParams.id,$scope.controlFactor=!1,"null"==$scope.currentCate&&($scope.controlFactor=!0),$scope.routeTime=$routeParams.date,$scope.setCurrentDate=function(date,num){1==num?($scope.currentTime=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate(),$scope.currentTimeLong=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate(),localStorageService.set("currentDateTime",{time:$scope.currentTime,longTime:$scope.currentTimeLong,type:1})):($scope.currentTime=date.getFullYear()+"-"+(date.getMonth()+1),$scope.currentTimeLong=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate(),localStorageService.set("currentDateTime",{time:$scope.currentTime,longTime:$scope.currentTimeLong,type:2}))},$scope.defineFunc=function(){$window.location.href="null"==$scope.currentCate?"#/transport":"null"==$scope.companyId?"#/exceed":"#/companyDetail/"+$scope.companyId+"/"+$scope.currentCate},$scope.archive=function(){var oldFactor=$scope.factorDataCache;oldFactor.splice(this.$index,1,{textName:this.factor.textName,textCode:this.factor.textCode,done:!this.factor.done}),localStorageService.set("currentFactor",oldFactor)},$scope.remaining=function(){var count=0;return angular.forEach($scope.factorDataCache,function(todo){count+=todo.done?1:0}),count}}),angular.module("fpiwebapp.category.ctrl",["LocalStorageModule"]).controller("CategoryController",function($scope,$rootScope,$location){$rootScope.checkUser(),$(".category").css("height",$rootScope.contentHeight+"px"),$scope.list=[],$scope.user="",$scope.passw="",$scope.submit=function(){$location.path("/main")}}),angular.module("fpiwebapp.home.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeController",function($scope,$rootScope,$routeParams,$location,$window,localStorageService,MenuServer,RegionService,HomeService){function drawProcess(){$("canvas.process").each(function(){var canpi=40,text=$(this).text(),process=text.substring(0,text.length-1),canvas=this,context=canvas.getContext("2d");context.clearRect(0,0,canpi,canpi),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI,!1),context.closePath(),context.fillStyle="#f5f5f5",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI*process/100,!1),context.closePath(),context.fillStyle="#ffa54b",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi-7,0,2*Math.PI,!0),context.closePath(),context.fillStyle="rgba(255,255,255,1)",context.fill(),context.font="bold 20px Arial",context.fillStyle="#ffa54b",context.textAlign="center",context.textBaseline="middle",context.moveTo(canpi,canpi),context.fillText(text,canpi,canpi)})}$scope.switchingCate=function(){console.log("fpi")},$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegion=localStorageService.get("currentRegions"),$scope.currentUser=localStorageService.get("currentUser"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),$scope.transPercentData=[],$scope.transPercentDataTxt=["传输率","有效率","传输有效率"],HomeService.getEfficiency({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,dateTime:"2014-9-3",userName:$scope.currentUser},function(result){if(result){var trans=result.transEfficients;$scope.transPercentData.push(trans[0].transPercent),$scope.transPercentData.push(trans[0].efficientPercent),$scope.transPercentData.push(trans[0].transEfficientPercent)}}),$scope.$on("ngRepeatFinished",function(){drawProcess()}),$scope.stateData=[],HomeService.getState({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,userName:$scope.currentUser},function(result){result&&($scope.stateData=result.region)}),HomeService.getOverStandardData({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode,time:"2014-8-3",userName:$scope.currentUser},function(result){}),$scope.imgWidth=$(document).width(),RegionService.query(function(result){var data=result.region;data&&($scope.regionName=localStorageService.get("currentRegion")||data[0].regionName)}),$scope.showCompanyDetail=function(){$location.path("/companyDetail/:id")}}).directive("onFinishRenderFilters",function($timeout){return{restrict:"A",link:function(scope){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.homeCate.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeCateController",function($route,$scope,$rootScope,$routeParams,$location,$window,localStorageService,MenuServer,RegionService,HomeService){function drawProcess(){var colors=["#ffa54b","#f57d6e","#53e18c"];$("canvas.process").each(function(index){var canpi=40,text=$(this).text(),process=text.substring(0,text.length-1),canvas=this,context=canvas.getContext("2d");context.clearRect(0,0,canpi,canpi),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI,!1),context.closePath(),context.fillStyle="#f5f5f5",context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi,0,2*Math.PI*process/100,!1),context.closePath(),context.fillStyle=colors[index],context.fill(),context.beginPath(),context.moveTo(canpi,canpi),context.arc(canpi,canpi,canpi-7,0,2*Math.PI,!0),context.closePath(),context.fillStyle="rgba(255,255,255,1)",context.fill(),context.font="normal 18px arial",context.fillStyle=colors[index],context.textAlign="center",context.textBaseline="middle",context.moveTo(canpi,canpi),context.fillText(text,canpi,canpi)})}$scope.nowDate=$rootScope.currentDate(0),$scope.preDate=$rootScope.currentDate(-1),$scope.currentUser=$rootScope.checkUser(),$scope.routeCategory=$routeParams.cateCode,localStorageService.set("currentCategory",$scope.routeCategory),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegion=localStorageService.get("currentRegions"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),"WW"==$scope.currentCategory&&($scope.isActive=!0),"WG"==$scope.currentCategory&&($scope.isSubActive=!0),$scope.refresh=function(){$route.reload()},console.log($scope.currentCategory),$scope.transPercentDataTxt=["传输率","有效率","传输有效率"],HomeService.getEfficiency({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode||"",dateTime:$scope.preDate,userName:$scope.currentUser},function(result){if(result){$scope.transPercentData=[];var trans=result.transEfficients;$scope.transPercentData.push({code:trans[0].transPercent}),$scope.transPercentData.push({code:trans[0].efficientPercent}),$scope.transPercentData.push({code:trans[0].transEfficientPercent}),console.log($scope.transPercentData)}}),$scope.$on("ngRepeatFinished",function(){drawProcess()}),$scope.stateData=[],HomeService.getState({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode||"",userName:$scope.currentUser},function(result){result&&($scope.stateData=result.region)}),$scope.noStandardData=!1,$scope.overStandardData=[],HomeService.getOverStandardData({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode||"",time:$scope.nowDate,dateType:1,userName:$scope.currentUser},function(result){result&&(result.overStandardData.length>0?$scope.overStandardData=result.overStandardData:$scope.noStandardData=!0)}),$scope.showCompanyDetail=function(id,currentCate){$window.location.href="#/companyDetail/"+id+"/"+currentCate}}).directive("onFinishRenderFilters",function($timeout){return{restrict:"A",link:function(scope){scope.$last===!0&&$timeout(function(){scope.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.home.service",["ngResource"]).factory("HomeService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},getState:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getState.do"},getDetailState:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getDetailState.do"},getEfficiency:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getTransmissionEfficientBySelfRegion.do"},getOverStandardData:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardData.do"},getOverStandardDataByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardDataByCompany.do"},getOverStandardDataFactor:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardDataFactor.do"},getDetailOverStandardDataByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getDetailOverStandardDataByCompany.do"},getOverStandardDataByOverData:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getOverStandardDataByOverData.do"},getPortsByCompany:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getPortsByCompany.do"},getRealDataByTable:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getRealDataByTable.do"},get24RealDataByChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/get24RealDataByChart.do"},get48RealDataByChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/get48RealDataByChart.do"},getHistoryData:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getHistoryData.do"},getHistoryChart:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getHistoryChart.do"},getTransmissionEfficientBychildRegion:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getTransmissionEfficientBychildRegion.do"},getFactorByPort:{method:"JSONP",url:platformServer+"/mobile/mobile/load/getFactorByPort.do"}})}]),angular.module("fpiwebapp.stateDetail.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("StateDetailController",function($routeParams,$rootScope,$scope,$location,$window,localStorageService,HomeService){$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),$scope.currentUser=$rootScope.checkUser(),$scope.state=$routeParams.state,$scope.noPortData=!0,$scope.stateDetailData=[],HomeService.getDetailState({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode||"",companyName:"",state:$scope.state,userName:$scope.currentUser},function(result){result&&($scope.stateDetailData=result.stateDetail)})}),angular.module("fpiwebapp.exceed.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("ExceedController",function($rootScope,$scope,$location,$window,localStorageService,MenuServer,HomeService){$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),$scope.currentUser=$rootScope.checkUser(),$scope.nowDate=$rootScope.currentDate(0),localStorageService.get("currentDateTime")||localStorageService.set("currentDateTime",{time:$scope.nowDate,longTime:$scope.nowDate,type:1}),$scope.currentTime=localStorageService.get("currentDateTime"),$scope.getCacheFactor=function(){if(localStorageService.get("currentFactor")){var factor=localStorageService.get("currentFactor"),factorArray=[],count=0;return angular.forEach(factor,function(todo){todo.done&&factorArray.push(todo.textCode),count+=todo.done?1:0}),count==factor.length?"-1":factorArray.toString()}return"-1"},$scope.noStandardData=!1,$scope.overStandardData=[],HomeService.getOverStandardDataByOverData({monitorTypeCode:$scope.currentCategory,regionCode:$scope.currentRegionCode||"",time:$scope.currentTime.time,dateType:$scope.currentTime.type,factorIds:$scope.getCacheFactor(),userName:$scope.currentUser},function(result){result&&(result.overStandardData.length>0?$scope.overStandardData=result.overStandardData:$scope.noStandardData=!0,$scope.setPortsFactorData())}),$scope.showCompanyDetail=function(id,currentCate){$window.location.href="#/companyDetail/"+id+"/"+currentCate},$scope.factorData=[],$scope.setPortsFactorData=function(){localStorageService.get("currentFactor")||HomeService.getOverStandardDataFactor({monitorTypeCode:$scope.currentCategory},function(result){result&&($scope.factorData=result.factor,$scope.factorDataCache=[],angular.forEach($scope.factorData,function(data){$scope.factorDataCache.push({textName:data.factorName,textCode:data.factorId,done:!0})}),localStorageService.set("currentFactor",$scope.factorDataCache))})}}),angular.module("fpiwebapp.transport.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("TransportController",function($rootScope,$scope,$location,$window,localStorageService,MenuServer,HomeService){$scope.currentUser=$rootScope.checkUser(),$scope.nowDate=$rootScope.currentDate(0),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.currentRegionCode=localStorageService.get("currentRegionCode"),$scope.nowDate=$rootScope.currentDate(0),localStorageService.get("currentDateTime")||localStorageService.set("currentDateTime",{time:$scope.nowDate,longTime:$scope.nowDate,type:1}),$scope.currentTime=localStorageService.get("currentDateTime"),$scope.transportItems=[],HomeService.getTransmissionEfficientBychildRegion({regionCode:"",dateTime:$scope.currentTime.time,monitorTypeCode:$scope.currentCategory,userName:$scope.currentUser,dateType:$scope.currentTime.type},function(result){result&&($scope.transportItems=result.transmissionEfficient)})}),angular.module("fpiwebapp.personal.ctrl",["LocalStorageModule","fpiwebapp.personal.service"]).controller("PersonalController",function($rootScope,$scope,$location,$window,localStorageService,MenuServer,PersonalService){$scope.currentCategory=localStorageService.get("currentCategory"),$scope.clearPortsCache=function(){localStorageService.remove("currentPorts")},$scope.currentUser=$rootScope.checkUser(),$scope.attentionCompanyList=[],$scope.historyLoading=!0,$scope.noAttenData=!0,$scope.showAttentionFunc=function(){PersonalService.showAttention({monitorTypeCode:$scope.currentCategory,userName:$scope.currentUser},function(result){result&&($scope.attentionCompanyList=result.attention,$scope.attentionCompanyList.length>=0&&($scope.historyLoading=!1),$scope.noAttenData=0==$scope.attentionCompanyList.length?!1:!0)})},$scope.showAttentionFunc(),$scope.isComp=!1,$scope.delAttention=[],$scope.isAttentionFunc=function(target,companyId){$scope.currentHeart=angular.element(target),"icon-heart"==$scope.currentHeart.context.className?($scope.currentHeart.context.className="icon-heart-empty",$scope.delAttention.push(companyId),$scope.isComp=$scope.delAttention.length>0?!0:!1):($scope.currentHeart.context.className="icon-heart",$scope.remove($scope.delAttention,companyId),$scope.isComp=$scope.delAttention.length>0?!0:!1)},$scope.remove=function(obj,val){var index=$scope.indexOf(obj,val);index>-1&&obj.splice(index,1)},$scope.indexOf=function(obj,val){for(var i=0;i<obj.length;i++)return obj[i]==val?i:-1},$scope.complateFunc=function(){angular.forEach($scope.delAttention,function(value){PersonalService.deleteAttention({userName:$scope.currentUser,companyId:value},function(){$scope.showAttentionFunc()})})}}),angular.module("fpiwebapp.account.ctrl",["LocalStorageModule"]).controller("AccountController",function($route,$scope,$rootScope,$location,$window,localStorageService){$scope.currentUser=$rootScope.checkUser(),$scope.signOut=function(){localStorageService.clearAll(),$route.reload()}}),angular.module("fpiwebapp.personal.service",["ngResource"]).factory("PersonalService",["$resource","platformServer",function($resource,platformServer){return $resource(platformServer+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},saveAttention:{method:"JSONP",url:platformServer+"/mobile/mobile/load/saveAttention.do"},hasAttention:{method:"JSONP",url:platformServer+"/mobile/mobile/load/hasAttention.do"},deleteAttention:{method:"JSONP",url:platformServer+"/mobile/mobile/load/deleteAttention.do"},showAttention:{method:"JSONP",url:platformServer+"/mobile/mobile/load/showAttention.do"}})}]),angular.module("fpiwebapp.personal.add.ctrl",["LocalStorageModule","fpiwebapp.personal.service","fpiwebapp.home.service"]).filter("keyWords",function(){return keyWordsFilter}).controller("AddCompanyController",function($rootScope,$window,$scope,$location,$routeParams,localStorageService,PersonalService,SearchService,$sce){$scope.currentUser=$rootScope.checkUser(),$scope.currentCategory=localStorageService.get("currentCategory"),$scope.toggle=!1,$scope.htmlShow=function(str){var key=$scope.name,words=str,color="#19b2e4",sKey="<span style='color: "+color+";'>"+key+"</span>",rStr=new RegExp(key,"g");return words=words.replace(rStr,sKey),$sce.trustAsHtml(words)},$scope.focusFunc=function(){console.log("focus"),$scope.toggle=!0},$scope.isNoData=!1,$scope.hasData=!1,$scope.name=$routeParams.key||"",$scope.companyArray=[],void 0!==$scope.name&&SearchService.search({monitorTypeCode:$scope.currentCategory,companyName:$scope.name,userName:$scope.currentUser},function(result){result&&($scope.companyAttentionArray=[],$scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0),angular.forEach($scope.companyArray,function(value){PersonalService.hasAttention({userName:$scope.currentUser,companyId:value.companyId},function(result){if(result){var txt={};"true"==result.result?(txt.html="已关注",txt.css="atten"):(txt.html="未关注",txt.css="addAtten"),$scope.companyAttentionArray.push(txt)}})}))}),$scope.addAttentionFunc=function(compId,txt){"已关注"!=txt&&PersonalService.saveAttention({userName:$scope.currentUser,companyId:compId},function(result){result&&$location.path("/personal")})},$scope.search=function(){$location.path("/searchAttention/"+$scope.key)},$scope.quickFunc=function(manageLevel){switch($scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!1,manageLevel){case 1:$scope.isActiveA=!0,$scope.isActiveB=!1,$scope.isActiveC=!1;break;case 2:$scope.isActiveA=!1,$scope.isActiveB=!0,$scope.isActiveC=!1;break;case 3:$scope.isActiveA=!1,$scope.isActiveB=!1,$scope.isActiveC=!0}SearchService.quickSearch({monitorTypeCode:$scope.currentCategory,manageLevel:manageLevel,userName:$scope.currentUser},function(result){result&&($scope.companyArray=result.company,$scope.companyArray.length>0?($scope.hasData=!0,$scope.isNoData=!1):($scope.hasData=!1,$scope.isNoData=!0))})},$scope.clearHistory=function(){$scope.companyArray=[]}}).filter("keyWords",function(){var keyWordsFilter=function(input){var text="",keyWords="长兴",words=input;return text=words.replace(keyWords,'<span style="color: red;">'+keyWords+"</span>")};return keyWordsFilter}),angular.module("fpiwebapp.companyDetail.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).filter("timeFormat",function(){var timeFormatFilter=function(input){return input.substring(0,13)+"时"};return timeFormatFilter}).controller("CompanyDetailController",function($route,$scope,$rootScope,$location,$window,$routeParams,localStorageService,MenuServer,HomeService){$scope.companyId=$routeParams.id,$scope.currentItem=$routeParams.currentCate,$scope.nowDate=$rootScope.currentDate(0),localStorageService.get("currentDateTime")||localStorageService.set("currentDateTime",{time:$scope.nowDate,longTime:$scope.nowDate,type:1}),$scope.currentTime=localStorageService.get("currentDateTime"),$scope.currentCategory=localStorageService.get("currentCategory")||"WW",$scope.isCompanyUser=!1,$scope.currentCompanyOrAdmin=localStorageService.get("currentCompanyOrAdmin"),"company"==$scope.currentCompanyOrAdmin&&($scope.isCompanyUser=!0,"WW"==$scope.currentCategory?($scope.isCompanyActive=!0,$scope.isSubCompanyActive=!1):($scope.isCompanyActive=!1,$scope.isSubCompanyActive=!0)),$("#isCompanyUserId > a").each(function(){$(this).on("click",function(){0==$(this).index()?($scope.isCompanyActive=!0,$scope.isSubCompanyActive=!1,localStorageService.set("currentCategory","WW"),$route.reload()):($scope.isSubCompanyActive=!0,$scope.isCompanyActive=!1,localStorageService.set("currentCategory","WG"),$route.reload())})}),$scope.refresh=function(){$route.reload()},$scope.isActive=!1,$scope.toggleCate=function(){$scope.isActive=!0},$scope.toggleLeave=function(){$scope.isActive=!1},$scope.portNameArray=[],$scope.portsDataByCompany=function(){HomeService.getPortsByCompany({monitorTypeCode:$scope.currentCategory,companyId:$scope.companyId},function(result){result&&($scope.portNameArray=result.ports,localStorageService.get("currentPorts")?($scope.currentPorts=localStorageService.get("currentPorts"),$scope.portTitle=$scope.currentPorts.portName,$scope.realDataByTable($scope.currentPorts.portId,$scope.currentPorts.portName),$scope.getHistoryDataFunc($scope.currentPorts.portId,$scope.currentTime),$scope.getHistoryDataFuncChart($scope.currentPorts.portId,$scope.currentTime),$scope.getOverStandarData($scope.currentPorts.portId,$scope.currentTime)):(localStorageService.set("currentPorts",{portName:result.ports[0].portName,portId:result.ports[0].portId}),$scope.portTitle=result.ports[0].portName,$scope.realDataByTable(result.ports[0].portId,result.ports[0].portName),$scope.getHistoryDataFunc(result.ports[0].portId,$scope.currentTime),$scope.getHistoryDataFuncChart(result.ports[0].portId,$scope.currentTime),$scope.getOverStandarData(result.ports[0].portId,$scope.currentTime),$scope.setPortsFactorData(result.ports[0].portId,$scope.currentCategory)))})},$scope.controlAllPorts=function(portId,portName){$scope.cartAllData=[],$scope.realDataByTable(portId,portName),$scope.getHistoryDataFunc(portId,$scope.currentTime),$scope.getHistoryDataFuncChart(portId,$scope.currentTime),$scope.getOverStandarData(portId,$scope.currentTime),$scope.setPortsFactorData(portId,$scope.currentCategory),$scope.isActiveHistory=!1},$scope.factorData=[],$scope.setPortsFactorData=function(portId){HomeService.getFactorByPort({portId:portId,monitorTypeCode:$scope.currentCategory},function(result){result&&($scope.factorData=result.factor,$scope.factorDataCache=[],angular.forEach($scope.factorData,function(data){$scope.factorDataCache.push({textName:data.factorName,textCode:data.factorId,done:!0})}),localStorageService.set("currentFactor",$scope.factorDataCache))})},$scope.getCacheFactor=function(){if(localStorageService.get("currentFactor")){var factor=localStorageService.get("currentFactor"),factorArray=[],count=0;return angular.forEach(factor,function(todo){todo.done&&factorArray.push(todo.textCode),count+=todo.done?1:0}),count==factor.length?"-1":factorArray.toString()}return"-1"},$scope.realDataByTableArray=[],$scope.realLoading=$scope.realDataByTableArray.length>0?!1:!0,$scope.realDataByTable=function(portId,portName){localStorageService.set("currentPorts",{portName:portName,portId:portId}),$scope.portTitle=localStorageService.get("currentPorts").portName,$scope.isActive=!1,HomeService.getRealDataByTable({monitorTypeCode:$scope.currentCategory,portId:portId},function(result){result&&($scope.realDataByTableArray=result.realDataTbale,$scope.clearRealData=$scope.realDataByTableArray.length?!0:!1,$scope.realLoading=!1)})},$scope.historyDataArray=[],$scope.historyLoading=$scope.historyDataArray.length>0?!1:!0,$scope.getHistoryDataFunc=function(portId,time){HomeService.getHistoryData({portId:portId,monitorTypeCode:$scope.currentCategory,factors:$scope.getCacheFactor(),dateType:time.type,time:time.time},function(result){result&&($scope.historyDataArray=result.data,$scope.clearData=$scope.historyDataArray.length?!0:!1,$scope.historyLoading=!1)})},$scope.cartAllData=[],$scope.keyWords=[],$scope.historyChartData=[],$scope.yMaxValue=[],$scope.xCoordinate=[],$scope.getHistoryDataFuncChart=function(portId,time){HomeService.getHistoryChart({monitorTypeCode:$scope.currentCategory,portId:portId,factors:$scope.getCacheFactor(),dateType:time.type,time:time.time},function(result){function formatTime(time){return time.indexOf(" ")>0?time.substring(11)+"时":time.substring(8)+"日"}if(result){$scope.historyChartData=result,$scope.yMaxValue=$scope.historyChartData.maxVal;var chartDataArray=[];$.each($scope.historyChartData,function(key,value){value instanceof Array&&"maxVal"!=key&&(chartDataArray.push({key:key,value:value}),$scope.keyWords.push(key))}),$.each(chartDataArray,function(index,value){var items=value.value,xLength=items.length,chartDataArrayNew=(Math.floor(xLength/4),[]);0==index&&$scope.xCoordinate.push({number:1,time:formatTime(items[0].time)});
for(var i=0;i<items.length;i++){var item=items[i],codeArray=[];if(codeArray.push(i+1,item.value),chartDataArrayNew.push(codeArray),0==index&&i%4==0){if(0==i||i==items.length-1)continue;$scope.xCoordinate.push({number:i+1,time:formatTime(items[i].time)})}}0==index&&$scope.xCoordinate.push({number:items.length,time:formatTime(items[items.length-1].time)}),$scope.cartAllData.push(chartDataArrayNew)})}})},$scope.overStandarData=[],$scope.getOverStandarData=function(portId,time){HomeService.getOverStandardDataByCompany({monitorTypeCode:$scope.currentCategory,portId:portId,factorIds:$scope.getCacheFactor(),dateType:time.type,time:time.time},function(result){result&&($scope.overStandarData=result.overStandardData,$scope.clearDataOver=$scope.overStandarData.length?!0:!1)})}}).directive("tabDetail",["$location",function(){return{restrict:"EA",replace:!0,templateUrl:"partials/company/tab-detail.html",link:function(scope){scope.isShow=!1},controller:function($scope,localStorageService){function controlTab(index){$(".tab-content").hide(),$(".tab-content").eq(index).show(),runCurrentLine(index),0==index?localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.realDataByTable($scope.currentPortsAll.portId,$scope.currentPortsAll.portName)):1==index?localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.getHistoryDataFunc($scope.currentPortsAll.portId,$scope.currentTime)):2==index&&localStorageService.get("currentPorts")&&($scope.currentPortsAll=localStorageService.get("currentPorts"),$scope.getOverStandarData($scope.currentPortsAll.portId,$scope.currentTime))}function runCurrentLine(index){line.animate({left:leftArray[index]+"px"})}$scope.portsDataByCompany();var currentItem=$scope.currentItem;$(".tab-content").hide(),$(".tab-content").eq(currentItem).show();for(var tabs=$(".tab").find("a"),line=$(".c-line"),leftArray=[],i=0;i<tabs.length;i++)leftArray.push(tabs[i].offsetLeft);line.css("left",leftArray[currentItem]+"px"),tabs.click(function(){var index=$(this).index();controlTab(index)}),controlTab($scope.currentItem)}}}]),angular.module("fpiwebapp.companyDetailTab.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("CompanyDetailTabController",function($scope,$rootScope,$location,$window,$routeParams,localStorageService,MenuServer,HomeService){$scope.curPorts=localStorageService.get("currentPorts"),$scope.showChartFunc=function($event,factoryCode){function drawChart24(maxValue,chartData){var myData=chartData,myChart=new JSChart("chartcontainer24","line");myChart.setDataArray(myData),myChart.setSize(320,220),myChart.setIntervalStartY(0),myChart.setIntervalEndY(maxValue),myChart.setAxisNameX(""),myChart.setAxisNameY(""),myChart.setTitle("24小时实时数据"),myChart.draw()}function drawChart48(maxValue,chartData){var myData=chartData,myChart=new JSChart("chartcontainer48","line");myChart.setDataArray(myData),myChart.setSize(320,220),myChart.setIntervalStartY(0),myChart.setIntervalEndY(maxValue),myChart.setAxisNameX(""),myChart.setAxisNameY(""),myChart.setTitle("48小时实时数据"),myChart.draw()}$scope.curPorts=localStorageService.get("currentPorts"),HomeService.get24RealDataByChart({portId:$scope.curPorts.portId,monitorTypeCode:$scope.currentCategory,factor:factoryCode},function(result){result&&($scope.real24ChartData=[],$scope.real24Data=result,$scope.maxData=$scope.real24Data.maxVal[0].maxVal,$scope.all24Data=$scope.real24Data[factoryCode],angular.forEach($scope.all24Data,function(value,key){var itemArray=[];itemArray.push(key),itemArray.push(value.value),$scope.real24ChartData.push(itemArray)}),drawChart24($scope.maxData,$scope.real24ChartData))}),HomeService.get48RealDataByChart({portId:$scope.curPorts.portId,monitorTypeCode:$scope.currentCategory,factor:factoryCode},function(result){result&&($scope.real48ChartData=[],$scope.real48Data=result,$scope.max48Data=$scope.real48Data.maxVal[0].maxVal,$scope.all48Data=$scope.real48Data[factoryCode],angular.forEach($scope.all48Data,function(value,key){var itemArray=[];itemArray.push(key),itemArray.push(value.value),$scope.real48ChartData.push(itemArray)}),drawChart48($scope.max48Data,$scope.real48ChartData))}),$event.currentTarget&&(angular.element("#chartTr")&&angular.element("#chartTr").remove(),angular.element($event.currentTarget).after('<tr id="chartTr"><td colspan="4"><div class="chartT2448"><a href="javascript:;" class="a24 cur">24小时</a><a href="javascript:;" class="a48">48小时</a></div><div id="chartcontainer24" style="margin: 0 auto; width: 320px;"></div><div id="chartcontainer48" style="margin: 0 auto; width: 320px; display: none"></div></td></tr>')),$(".chartT2448 > a").each(function(index){$(this).click(function(){0==index?($(".chartT2448 > a").removeClass("cur"),$(this).addClass("cur"),$("#chartcontainer24").show(),$("#chartcontainer48").hide(),drawChart24($scope.maxData,$scope.real24ChartData)):($(".chartT2448 > a").removeClass("cur"),$(this).addClass("cur"),$("#chartcontainer24").hide(),$("#chartcontainer48").show(),drawChart48($scope.max48Data,$scope.real48ChartData))})})},$scope.addRow=function(target){console.log(target.parent)},$scope.myText="Not Selected",$scope.currentDate="",$scope.updateMyText=function(){$scope.myText="Selected"},$scope.showHistoryChart=function(){$scope.isActiveHistory=!0;var colorArray=[];if($scope.cartAllData.length){$("#history-chart").show(),$("#chart-text").hide();var myChart=new JSChart("history-chart","line");colorArray=[{name:"red",value:"#fb1929",text:"COD"},{name:"yellow",value:"#ffc600",text:""},{name:"blue",value:"#387eff",text:""},{name:"green",value:"#30ff00",text:""},{name:"violet",value:"#fa00fd",text:""},{name:"hunan",value:"#00e4ff",text:""},{name:"zhise",value:"#ff00e4",text:""},{name:"meihong",value:"#ff007e",text:""}];for(var i=0;i<$scope.cartAllData.length;i++){var item=$scope.cartAllData[i];myChart.setDataArray(item,colorArray[i].name),myChart.setLineColor(colorArray[i].value,colorArray[i].name),myChart.setLegendShow(!0),myChart.setLegendPosition("top center"),myChart.setLegendForLine(colorArray[i].name,$scope.keyWords[i])}myChart.setAxisPaddingBottom(40),myChart.setTextPaddingBottom(10),myChart.setIntervalStartY(0),myChart.setIntervalEndY($scope.yMaxValue[0].maxVal),myChart.setAxisNameX(""),myChart.setAxisNameY("");for(var j=0;j<$scope.xCoordinate.length;j++){var jitem=$scope.xCoordinate[j];myChart.setLabelX([jitem.number,jitem.time])}myChart.setAxisValuesNumberX(5),myChart.setShowXValues(!1),myChart.setTitleColor("#454545"),myChart.setAxisValuesColor("#454545"),myChart.setFlagColor("#9D16FC"),myChart.setFlagRadius(4),myChart.setSize(320,321),myChart.setTitle("历史数据图表"),myChart.draw()}else $("#history-chart").hide(),$("#chart-text").html('<div class="no-chart-text">暂无图表数据</div>')},$scope.isActiveHistory=!1,$scope.showHistoryTable=function(){$scope.isActiveHistory=!1}}),angular.module("fpiwebapp.common",[]).factory("platformServer",function(){return platformServer}).factory("LoadingServer",function(){var LoadingServer=function(){};return LoadingServer.prototype={},LoadingServer}).factory("MenuServer",function($rootScope){var MenuServer=function(){this.cover=null,this.menuArray=[]};return MenuServer.prototype={init:function(){this.createMenu(),this.createBgDom(),this.hideItems()},showItems:function(){for(var self=this,i=0;i<self.menuArray.length;i++)$(self.menuArray[i]).show(),function(item){setTimeout(function(){$(self.menuArray[item]).animate({left:"20px"})},100*(item+1))}(i);$(self.cover).show()},hideItems:function(){for(var self=this,i=0;i<self.menuArray.length;i++)$(self.menuArray[i]).hide().css("left","0");$(self.cover).hide()},createBgDom:function(){var self=this;this.cover=document.createElement("div"),this.cover.setAttribute("class","coverCls"),this.cover.style.height=jQuery(document).height()+"px",$("body").append(this.cover),this.cover.addEventListener("click",function(){self.hideItems()})},removeCoverItem:function(){var self=this;self.cover.remove()},removeMenuItem:function(){for(var self=this,i=0;i<self.menuArray.length;i++)self.menuArray[i].remove();$rootScope.isChoice=!1},createMenu:function(){for(var self=this,pmenu=[],menus=[{name:"首页",href:"#/main",url:"images/home.png"},{name:"超标统计",href:"#/exceed",url:"images/m2.png"},{name:"传输有效率",href:"#/transport",url:"images/m3.png"},{name:"我的关注",href:"#/personal",url:"images/m4.png"}],i=0;i<menus.length;i++){var menuItem=document.createElement("div");menuItem.setAttribute("class","menuItemCls"),menuItem.innerHTML='<a href="'+menus[i].href+'"><img src="'+menus[i].url+'" width="32" height="32" border="0">'+menus[i].name+"</a>",menuItem.style.top=20+50*(i+1)+"px",$("body").append(menuItem),this.menuArray.push(menuItem),pmenu.push(menuItem),menuItem.addEventListener("click",function(){self.hideItems()})}}},MenuServer}),angular.module("fpiwebapp.directives",[]).directive("datepicker",function(){return{restrict:"A",require:"?ngModel",scope:{select:"&"},link:function(scope,element,attrs,ngModel){if(ngModel){var optionsObj={};optionsObj.dateFormat="mm/dd/yy";var updateModel=function(dateTxt){scope.$apply(function(){ngModel.$setViewValue(dateTxt)})};optionsObj.onSelect=function(dateTxt){updateModel(dateTxt),scope.select&&scope.$apply(function(){scope.select({date:dateTxt})})},ngModel.$render=function(){element.datepicker("setDate",ngModel.$viewValue||"")},element.datepicker(optionsObj)}}}}),angular.module("fpiwebapp.calendar",["fpiwebapp.service","LocalStorageModule"]).directive("calendar",function(dateutil,localStorageService){function CalendarModel(date){this.currentDate=date,this.weekNumber=dateutil.getWeekNumberOfMonth(date),this.firstDate=dateutil.getFirstDateOfFirstWeek(date),this.firstMonth=dateutil.getMonthOfYear(date),this.fY=this.firstDate.getFullYear(),this.fM=this.firstDate.getMonth(),this.fD=this.firstDate.getDate(),this.fY1=this.firstMonth.getFullYear(),this.fM1=this.firstMonth.getMonth(),this.fD1=this.firstMonth.getDate()}return CalendarModel.prototype={get:function(index){return new Date(this.fY,this.fM,this.fD+index)},getMonthId:function(index){return new Date(this.fY1,this.fM1+index,this.fD1)},getDate:function(index){return this.get(index).getDate()},getMonth:function(index){return this.getMonthId(index).getMonth()+1},monthText:function(){return this.currentDate.getFullYear()+"年"+(this.currentDate.getMonth()+1)+"月"+this.currentDate.getDate()+"日"},showMonthText:function(){return this.currentDate.getFullYear()+"年"+(this.currentDate.getMonth()+1)+"月"},checkWeek:function(week){return this.weekNumber>=week},isCurrentMonth:function(index){var date=this.get(index);return date.getMonth()==this.currentDate.getMonth()},isCurrentMonthNumber:function(index){return index==this.currentDate.getMonth()},isCurrentDate:function(index){var date=this.get(index);return date.getFullYear()==this.currentDate.getFullYear()&&date.getMonth()==this.currentDate.getMonth()&&date.getDate()==this.currentDate.getDate()}},{restrict:"EA",replace:!0,scope:{updateDateMethod:"@"},templateUrl:"/app/partials/calendar.html",link:function(scope,element){function autoTabShow(time){var isMonthDay=time.indexOf("-",5);-1!=isMonthDay?($(".choose-p-t-r a").eq(0).addClass("cur").siblings().removeClass("cur"),$("#dayArea").show(),$("#monthArea").hide(),$("#isShowDay").show(),$("#isShowMonth").hide()):($(".choose-p-t-r a").eq(1).addClass("cur").siblings().removeClass("cur"),$("#dayArea").hide(),$("#monthArea").show(),$("#isShowDay").hide(),$("#isShowMonth").show())}autoTabShow(scope.$parent.routeTime);var nowDate=localStorageService.get("currentDateTime"),now=new Date(Date.parse(nowDate.longTime.replace(/-/g,"/")));element.on("swiperight",function(){alert("fuck")}),$(".fpiwebapp-calendar a",element).each(function(i){$(this).on("click",function(){var currentDate=scope.calendarModel.get(i),parentUpdateDateMethod=scope.$parent[scope.updateDateMethod];parentUpdateDateMethod&&parentUpdateDateMethod(currentDate,1),scope.calendarModel=new CalendarModel(currentDate),scope.$apply(scope.calendarModel)})}),$(".fpiwebapp-calendar-month a",element).each(function(i){$(this).on("click",function(){var currentMonth=scope.calendarModel.getMonthId(i),parentUpdateMonthMethod=scope.$parent[scope.updateDateMethod];parentUpdateMonthMethod&&parentUpdateMonthMethod(currentMonth,2),scope.calendarModel=new CalendarModel(currentMonth),scope.$apply(scope.calendarModel)})}),$(".choose-p-t-r a").each(function(){$(this).on("click",function(){$(this).addClass("cur").siblings().removeClass("cur"),0==$(this).index()?($("#dayArea").show(),$("#monthArea").hide(),$("#isShowDay").show(),$("#isShowMonth").hide()):($("#dayArea").hide(),$("#monthArea").show(),$("#isShowDay").hide(),$("#isShowMonth").show())})}),scope.calendarModel=new CalendarModel(now)}}}),angular.module("fpiwebapp.service",[]).factory("dateutil",function(){return{getWeekNumberOfMonth:function(date){return this.getWeekOfMonth(this.getLastDateOfMonth(date))},getMonthOfYear:function(date){var d=new Date(date.getFullYear(),date.getMonth(),date.getDate());return d.setMonth(0),d},getWeekOfMonth:function(date){var dayOfWeek=date.getDay(),dayOfMonth=date.getDate();return Math.ceil((dayOfMonth-(dayOfWeek+1)+7)/7)},getLastDateOfMonth:function(date){return new Date(date.getFullYear(),date.getMonth()+1,0)},getFirstDateOfFirstWeek:function(date){var d=new Date(date.getFullYear(),date.getMonth(),date.getDate());d.setDate(1);var dayOfWeek=d.getDay();return d.setDate(1-dayOfWeek),d}}});