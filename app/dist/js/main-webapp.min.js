"use strict";angular.module("fpiwebapp.login.service",["ngResource"]).factory("LoginService",["$resource",function(a){return a("http://122.224.196.67:10001/mobile/mobile/load/login.do",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"}})}]),angular.module("fpiwebapp",["ngRoute","fpiwebapp.region.service","fpiwebapp.region.ctrl","fpiwebapp.search.ctrl","fpiwebapp.choose.ctrl","fpiwebapp.category.ctrl","fpiwebapp.home.ctrl","fpiwebapp.homeCate.ctrl","fpiwebapp.exceed.ctrl","fpiwebapp.transport.ctrl","fpiwebapp.personal.ctrl","fpiwebapp.account.ctrl","fpiwebapp.companyDetail.ctrl","fpiwebapp.companyDetailTab.ctrl","fpiwebapp.common","fpiwebapp.home.service","fpiwebapp.directives","angular-md5","LocalStorageModule"]).config(function(a){a.when("/",{controller:"HomeController",templateUrl:"/app/partials/home/home.html"}).when("/cate/:cateCode",{controller:"HomeCateController",templateUrl:"/app/partials/home/home.html"}).when("/account",{controller:"AccountController",templateUrl:"/app/partials/personal/account.html"}).when("/selectRegion",{controller:"SelectRegionController",templateUrl:"/app/partials/region/region.html"}).when("/choose",{controller:"ChooseController",templateUrl:"/app/partials/choose/choose.html"}).when("/search",{controller:"SearchController",templateUrl:"/app/partials/search/search.html"}).when("/exceed",{controller:"ExceedController",templateUrl:"/app/partials/exceed/exceed.html"}).when("/transport",{controller:"TransportController",templateUrl:"/app/partials/transport/transport.html"}).when("/personal",{controller:"PersonalController",templateUrl:"/app/partials/personal/personal.html"}).when("/companyDetail/:id",{controller:"CompanyDetailController",templateUrl:"/app/partials/company/companyDetail.html"}).otherwise({redirectTo:"/"})}).run(function(a,b,c,d,e,f){b.back=function(){c.history.back()},b.categoryItem="WW",b.choiceMenu=function(){b.menu.showItems()},b.contentHeight=$(window).innerHeight(),b.checkUser=function(){return b.user=f.get("currentUser"),b.user?b.user:void(c.location.href="/")},b.currentDate=function(a){var b="",c=new Date;return c.setDate(c.getDate()+a),b=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()}}),angular.module("fpiwebapp.region.service",["ngResource"]).factory("RegionService",["$resource","platformServer",function(a,b){return a(b+"/mobile/mobile/load/getRegion.do?monitorTypeCode=WW&userName=root",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"}})}]),angular.module("fpiwebapp.region.ctrl",["LocalStorageModule"]).controller("SelectRegionController",function(a,b,c,d,e){a.currentName=d.get("currentRegions"),a.currentCate=d.get("currentCategory"),a.isLoading=!1,a.regions=[],e.query(function(b){var c=b.region;if(c.length>0){for(var d=0;d<c.length;d++){var e=c[d];a.regions.push(e.regionName)}a.isLoading=!0,a.dataFunc(a.regions)}}),a.dataFunc=function(b){for(var c=[],d=0;d<b.length;d++)d%3==0&&c.push([]),c[c.length-1].push(b[d]);return a.areas=c},a.dataFunc(a.regions),a.selectFunc=function(c){console.log(c),d.set("currentRegions",c),b.path("/cate/"+a.currentCate)}}),angular.module("fpiwebapp.search.ctrl",["LocalStorageModule"]).controller("SearchController",function(a,b,c,d){a.menu.hideItems(),b.searchCompanyName=[],b.name=d.name,b.searchCompany=function(){b.name;console.log(b.name)}}),angular.module("fpiwebapp.choose.ctrl",["LocalStorageModule"]).controller("ChooseController",function(a,b,c,d,e){b.factorData=e.get("currentFactor"),b.archive=function(){var c=b.factorData;c.splice(this.$index,1,{text:this.factor.text,done:!this.factor.done}),e.set("currentFactor",c),a.isFactorSave=!1},b.remaining=function(){var a=0;return angular.forEach(b.factorData,function(b){a+=b.done?1:0}),a}}),angular.module("fpiwebapp.category.ctrl",["LocalStorageModule"]).controller("CategoryController",function(a,b,c){b.checkUser(),$(".category").css("height",b.contentHeight+"px"),a.list=[],a.user="",a.passw="",a.submit=function(){c.path("/main")}}),angular.module("fpiwebapp.home.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeController",function(a,b,c,d,e,f,g,h,i){function j(){$("canvas.process").each(function(){var a=40,b=$(this).text(),c=b.substring(0,b.length-1),d=this,e=d.getContext("2d");e.clearRect(0,0,a,a),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="#f5f5f5",e.fill(),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a,0,2*Math.PI*c/100,!1),e.closePath(),e.fillStyle="#ffa54b",e.fill(),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a-7,0,2*Math.PI,!0),e.closePath(),e.fillStyle="rgba(255,255,255,1)",e.fill(),e.font="bold 20px Arial",e.fillStyle="#ffa54b",e.textAlign="center",e.textBaseline="middle",e.moveTo(a,a),e.fillText(b,a,a)})}a.switchingCate=function(){console.log("fpi")},a.currentCategory=f.get("currentCategory"),a.currentRegion=f.get("currentRegions"),a.currentUser=f.get("currentUser"),a.currentRegionCode=f.get("currentRegionCode"),a.transPercentData=[],a.transPercentDataTxt=["传输率","有效率","传输有效率"],i.getEfficiency({monitorTypeCode:a.currentCategory,regionCode:a.currentRegionCode,dateTime:"2014-9-3",userName:a.currentUser},function(b){if(b){var c=b.transEfficients;a.transPercentData.push(c[0].transPercent),a.transPercentData.push(c[0].efficientPercent),a.transPercentData.push(c[0].transEfficientPercent)}}),a.$on("ngRepeatFinished",function(){j()}),a.stateData=[],i.getState({monitorTypeCode:a.currentCategory,regionCode:a.currentRegionCode,userName:a.currentUser},function(b){b&&(a.stateData=b.region)}),i.getOverStandardData({monitorTypeCode:a.currentCategory,regionCode:a.currentRegionCode,time:"2014-8-3",userName:a.currentUser},function(a){}),a.imgWidth=$(document).width(),h.query(function(b){var c=b.region;c&&(a.regionName=f.get("currentRegion")||c[0].regionName)}),a.showCompanyDetail=function(){d.path("/companyDetail/:id")}}).directive("onFinishRenderFilters",function(a){return{restrict:"A",link:function(b){b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.homeCate.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("HomeCateController",function(a,b,c,d,e,f,g,h,i,j){function k(){$("canvas.process").each(function(){var a=40,b=$(this).text(),c=b.substring(0,b.length-1),d=this,e=d.getContext("2d");e.clearRect(0,0,a,a),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a,0,2*Math.PI,!1),e.closePath(),e.fillStyle="#f5f5f5",e.fill(),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a,0,2*Math.PI*c/100,!1),e.closePath(),e.fillStyle="#ffa54b",e.fill(),e.beginPath(),e.moveTo(a,a),e.arc(a,a,a-7,0,2*Math.PI,!0),e.closePath(),e.fillStyle="rgba(255,255,255,1)",e.fill(),e.font="normal 20px Calibri",e.fillStyle="#ffa54b",e.textAlign="center",e.textBaseline="middle",e.moveTo(a,a),e.fillText(b,a,a)})}b.nowDate=c.currentDate(0),b.preDate=c.currentDate(-1),b.currentUser=c.checkUser(),b.routeCategory=d.cateCode,g.set("currentCategory",b.routeCategory),b.currentCategory=g.get("currentCategory"),b.currentRegion=g.get("currentRegions"),b.currentRegionCode=g.get("currentRegionCode"),"WW"==b.currentCategory&&(b.isActive=!0),"WG"==b.currentCategory&&(b.isSubActive=!0),b.refresh=function(){a.reload()},console.log(b.currentCategory),b.transPercentData=[],b.transPercentDataTxt=["传输率","有效率","传输有效率"],j.getEfficiency({monitorTypeCode:b.currentCategory,regionCode:b.currentRegionCode,dateTime:b.preDate,userName:b.currentUser},function(a){if(a){var c=a.transEfficients;b.transPercentData.push(c[0].transPercent),b.transPercentData.push(c[0].efficientPercent),b.transPercentData.push(c[0].transEfficientPercent)}}),b.$on("ngRepeatFinished",function(){k()}),b.stateData=[],j.getState({monitorTypeCode:b.currentCategory,regionCode:b.currentRegionCode,userName:b.currentUser},function(a){a&&(b.stateData=a.region)}),b.overStandardData=[],j.getOverStandardData({monitorTypeCode:b.currentCategory,regionCode:"33010401",time:b.nowDate,userName:b.currentUser},function(a){a&&(b.overStandardData=a.overStandardData)}),b.showCompanyDetail=function(){e.path("/companyDetail/:id")}}).directive("onFinishRenderFilters",function(a){return{restrict:"A",link:function(b){b.$last===!0&&a(function(){b.$emit("ngRepeatFinished")})}}}),angular.module("fpiwebapp.home.service",["ngResource"]).factory("HomeService",["$resource","platformServer",function(a,b){return a(b+"",{callback:"JSON_CALLBACK"},{query:{method:"JSONP"},getState:{method:"JSONP",url:b+"/mobile/mobile/load/getState.do"},getEfficiency:{method:"JSONP",url:b+"/mobile/mobile/load/getTransmissionEfficientBySelfRegion.do"},getOverStandardData:{method:"JSONP",url:b+"/mobile/mobile/load/getOverStandardData.do"},getOverStandardDataByCompany:{method:"JSONP",url:b+"/mobile/mobile/load/getOverStandardDataByCompany.do"},getDetailOverStandardDataByCompany:{method:"JSONP",url:b+"/mobile/mobile/load/getDetailOverStandardDataByCompany.do"}})}]),angular.module("fpiwebapp.exceed.ctrl",["LocalStorageModule"]).controller("ExceedController",function(){}),angular.module("fpiwebapp.transport.ctrl",["LocalStorageModule"]).controller("TransportController",function(){}),angular.module("fpiwebapp.personal.ctrl",["LocalStorageModule"]).controller("PersonalController",function(){}),angular.module("fpiwebapp.account.ctrl",["LocalStorageModule"]).controller("AccountController",function(a,b,c,d,e,f){b.currentUser=c.checkUser(),b.signOut=function(){f.clearAll(),a.reload()}}),angular.module("fpiwebapp.companyDetail.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).directive("tabDetail",function(){return{restrict:"EA",replace:!0,templateUrl:"partials/company/tab-detail.html",link:function(a){a.isShow=!1},controller:function(a){function b(a){e.animate({left:f[a]+"px"})}var c=a.currentItem;$(".tab-content").hide(),$(".tab-content").eq(c).show();for(var d=$(".tab").find("a"),e=$(".c-line"),f=[],g=0;g<d.length;g++)f.push(d[g].offsetLeft);console.log(f),e.css("left",f[c]+"px"),d.click(function(){var a=$(this).index();$(".tab-content").hide(),$(".tab-content").eq(a).show(),b(a)})}}}).controller("CompanyDetailController",function(a,b,c,d){console.log(d),a.currentItem=2}),angular.module("fpiwebapp.companyDetailTab.ctrl",["LocalStorageModule","fpiwebapp.home.service"]).controller("CompanyDetailTabController",function(a,b,c,d,e,f,g,h){a.myText="Not Selected",a.currentDate="",a.updateMyText=function(){a.myText="Selected"};a.overStandarData=[],h.getOverStandardDataByCompany({monitorTypeCode:"WW",portId:"2c93871641b498170141b49cfb6b0004",factorIds:"-1",dateType:1,time:"2014-09-09"},function(b){if(b){var c=b.overStandardData;a.factor=[],a.factorAll=[],angular.forEach(c,function(b){a.factorAll.push({text:b.fatorName,done:!0})});var d=f.get("currentFactor");d?(angular.forEach(d,function(b){b.done||a.factor.push(b.text)}),a.overStandarData=function(){var b=[];return angular.forEach(a.factor,function(a){angular.forEach(c,function(b,d){b.fatorName.toLowerCase()==a.toLowerCase()&&c.splice(d,1)})}),b=c}()):(f.set("currentFactor",a.factorAll),a.overStandarData=c)}}),h.getDetailOverStandardDataByCompany({monitorTypeCode:"WW",portId:"2c93871641b498170141b49cfb6b0004",factorId:"2c93871641b5db390141b5def6f80001",standardValue:"30.0",companyName:"长兴兴长污水处理有限公司",dateType:1,time:"2014-09-09"},function(a){})}),angular.module("fpiwebapp.common",[]).factory("platformServer",function(){return platformServer}).factory("LoadingServer",function(){var a=function(){};return a.prototype={},a}).factory("MenuServer",function(a){var b=function(){this.cover=null,this.menuArray=[]};return b.prototype={init:function(){this.createMenu(),this.createBgDom(),this.hideItems()},showItems:function(){for(var a=this,b=0;b<a.menuArray.length;b++)$(a.menuArray[b]).show(),function(b){setTimeout(function(){$(a.menuArray[b]).animate({left:"20px"})},100*(b+1))}(b);$(a.cover).show()},hideItems:function(){for(var a=this,b=0;b<a.menuArray.length;b++)$(a.menuArray[b]).hide().css("left","0");$(a.cover).hide()},createBgDom:function(){var a=this;this.cover=document.createElement("div"),this.cover.setAttribute("class","coverCls"),this.cover.style.height=jQuery(document).height()+"px",$("body").append(this.cover),this.cover.addEventListener("click",function(){a.hideItems()})},removeCoverItem:function(){var a=this;a.cover.remove()},removeMenuItem:function(){for(var b=this,c=0;c<b.menuArray.length;c++)b.menuArray[c].remove();a.isChoice=!1},createMenu:function(){for(var a=this,b=[],c=[{name:"首页",href:"#/main",url:"images/home.png"},{name:"超标统计",href:"#/exceed",url:"images/m2.png"},{name:"传输有效率",href:"#/transport",url:"images/m3.png"},{name:"我的关注",href:"#/personal",url:"images/m4.png"}],d=0;d<c.length;d++){var e=document.createElement("div");e.setAttribute("class","menuItemCls"),e.innerHTML='<a href="'+c[d].href+'"><img src="'+c[d].url+'" width="32" height="32" border="0">'+c[d].name+"</a>",e.style.top=20+50*(d+1)+"px",$("body").append(e),this.menuArray.push(e),b.push(e),e.addEventListener("click",function(){a.hideItems()})}}},b}),angular.module("fpiwebapp.directives",[]).directive("datepicker",function(){return{restrict:"A",require:"?ngModel",scope:{select:"&"},link:function(a,b,c,d){if(d){var e={};e.dateFormat="mm/dd/yy";var f=function(b){a.$apply(function(){d.$setViewValue(b)})};e.onSelect=function(b){f(b),a.select&&a.$apply(function(){a.select({date:b})})},d.$render=function(){b.datepicker("setDate",d.$viewValue||"")},b.datepicker(e)}}}});